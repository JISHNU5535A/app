{"ts":1370581031608,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"express = require 'express'\napp = express()\nport = 80\n\nmodels = require('./models')\nmongoose = require('mongoose')\nMSG = mongoose.model('msg')\n\napp.use(express.static(__dirname + '/public'))\napp.set('views', __dirname + '/tpl')\napp.set('view engine', 'jade')\napp.engine('jade', require('jade').__express)\n\napp.get('/', (req, res) ->\n    res.render('page')\n)\n\napp.get('/oauth2callback', (req, res) ->\n    console.log req\n    # console.log res\n    res.send 'oauth2 working'\n)\n \napp.get('/works', (req, res) ->\n\tconsole.dir(req.headers) # req.headers['user-agent']\n\tres.send('Works')\n)\n \n# app.listen(port);\nio = require('socket.io').listen(app.listen(port))\n\nio.sockets.on('connection', (socket) ->\n\tconsole.log('client connected ')\n\tconsole.log(socket.id)\n\td = new Date()\n\tclock = d.toLocaleTimeString()\n\tsocket.emit('message', { m: 'welcome to the chat '+clock })\n\tsocket.on('send', (data) ->\n\t\tio.sockets.emit('message', data)\n\t\tconsole.log \"Sent Data: \"\n\t\tconsole.dir data\n\t\tmsg = new MSG({\n\t\t\tm: data.m\n\t\t\tn: \"Yash Kumar\" \n\t\t\tt: new Date().getTime()\n\t\t})\n\n\t\tmsg.save( (err) ->\n\t\t\tif (err)\n\t\t\t\treturn err;\n\t\t\telse\n\t\t  \tconsole.log \"Saved Message: \"+msg\n\t\t)\n\t)\n)\n\n# io.disable('heartbeats')\n\nconsole.log(\"Listening on port \" + port)"]],"start1":0,"start2":0,"length1":0,"length2":1233}]],"length":1233}
